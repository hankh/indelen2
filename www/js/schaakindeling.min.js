(function(){var aantalspelers,bewaarcompetform,bewaarspelerform,bewaaruitslagform,competnaam,competnr,curronde,eerstepagranglijst,eerstepagrondelijst,eerstepagspelerlijst,eerstescorecheck,initaantalspelersform,inituitslagen,loadcompet,resetcompet,savecompet,stand,storage,testcompetbestaat,toonronde,toonspeler,toonspelers,toonstand,toonuitslag,transronde,uitslagen,vbspelers,verbscore,volgenderonde,vorigeronde;storage=$.localStorage;competnr=1;competnaam="";aantalspelers=8;curronde=1;uitslagen=[];eerstepagspelerlijst=false;eerstepagrondelijst=false;eerstescorecheck=false;eerstepagranglijst=false;stand=[];verbscore=["1-0","0-1","rem"];vbspelers=[];initaantalspelersform=function(){};transronde=function(spelernr,aspelers){var draai,nwspelernr;draai=aspelers/2;nwspelernr=spelernr+draai;if(nwspelernr>aspelers-1){nwspelernr=nwspelernr-aspelers+1}return nwspelernr};inituitslagen=function(){var nrondes,ntafels,r,rondetafel,t,tempronde,tempuit,uitslag,wit,zwart,_i,_j,_results;nrondes=aantalspelers-1;ntafels=aantalspelers/2;uitslagen=[];tempronde=[];for(t=_i=1;1<=ntafels?_i<=ntafels:_i>=ntafels;t=1<=ntafels?++_i:--_i){tempuit={kwit:0,kzwart:0};tempronde.push(tempuit)}_results=[];for(r=_j=1;1<=nrondes?_j<=nrondes:_j>=nrondes;r=1<=nrondes?++_j:--_j){_results.push(function(){var _k,_results1;_results1=[];for(t=_k=1;1<=ntafels?_k<=ntafels:_k>=ntafels;t=1<=ntafels?++_k:--_k){rondetafel=tempronde[t-1];if(r===1){if(t===1){wit=1;zwart=aantalspelers}else{wit=wit+1;zwart=zwart-1}}else{if(t===1){if(rondetafel.kwit===aantalspelers){wit=transronde(rondetafel.kzwart,aantalspelers);zwart=aantalspelers}else{zwart=transronde(rondetafel.kwit,aantalspelers);wit=aantalspelers}}else{wit=transronde(rondetafel.kwit,aantalspelers);zwart=transronde(rondetafel.kzwart,aantalspelers)}}rondetafel.kwit=wit;rondetafel.kzwart=zwart;uitslag={ronde:r,tafel:t,wit:wit,zwart:zwart,score:0};_results1.push(uitslagen.push(uitslag))}return _results1}())}return _results};savecompet=function(){var compet;compet={nr:competnr,competnaam:competnaam,aantalspelers:aantalspelers,competnaam:competnaam,spelers:vbspelers,uitslagen:uitslagen};storage.set("compet"+competnr.toString(),compet)};loadcompet=function(){var compet;compet=storage.get("compet"+competnr.toString());aantalspelers=0;competnaam="";if(compet.aantalspelers!=null){aantalspelers=parseInt(compet.aantalspelers);if(aantalspelers<0){aantalspelers=0}}if(compet.competnaam!=null){competnaam=compet.competnaam}if(compet.spelers!=null){if(compet.spelers.length>0){vbspelers=compet.spelers}}uitslagen=compet.uitslagen};toonstand=function(){var curscore,desc,n,reg,s,standspeler,_i,_j,_k,_len,_len1;stand=[];for(n=_i=1;1<=aantalspelers?_i<=aantalspelers:_i>=aantalspelers;n=1<=aantalspelers?++_i:--_i){standspeler={nr:n,score:0,gespeeld:0};stand.push(standspeler)}for(_j=0,_len=uitslagen.length;_j<_len;_j++){reg=uitslagen[_j];if(reg.score>0){stand[reg.wit-1].gespeeld+=1;stand[reg.zwart-1].gespeeld+=1}switch(reg.score){case 1:stand[reg.wit-1].score+=2;break;case 2:stand[reg.zwart-1].score+=2;break;case 3:stand[reg.zwart-1].score+=1;stand[reg.wit-1].score+=1}}$("#ranglijst").empty();stand=stand.sortBy(function(x){return x.score.format(1)+(aantalspelers-x.gespeeld).format()},desc=true);for(_k=0,_len1=stand.length;_k<_len1;_k++){reg=stand[_k];if(reg.gespeeld>0){curscore=reg.score/2;s="<li>"+vbspelers[reg.nr-1].naam+"<div class='vulrechts'>"+curscore.format(1)+" uit "+reg.gespeeld.toString()+"</div></li>"}else{s="<li>"+vbspelers[reg.nr-1].naam+"</li>"}$("#ranglijst").append(s);n=n+1}if(eerstepagranglijst){$("#ranglijst").listview("refresh")}else{eerstepagranglijst=true}jQuery.mobile.changePage("#pagranglijst");return true};toonspelers=function(){var n,reg,s,_i,_len;s="";n=0;$("#vlijst").empty();for(_i=0,_len=vbspelers.length;_i<_len;_i++){reg=vbspelers[_i];s='<li><a href="javascript:toonspeler('+n.toString()+');">'+reg.naam+"</a></li>";$("#vlijst").append(s);n=n+1}if(eerstepagspelerlijst){$("#vlijst").listview("refresh")}else{eerstepagspelerlijst=true}jQuery.mobile.changePage("#pagspelers");return true};toonronde=function(n){var curscore,reg,s,_i,_len;n=parseInt(n);console.log(n);if(n===0){n=curronde}else{curronde=n}s="";$("#rondenr").html("Ronde "+n.toString());$("#rondelijst").empty();for(_i=0,_len=uitslagen.length;_i<_len;_i++){reg=uitslagen[_i];if(reg.ronde===n){if(reg.score>0){curscore=" : "+verbscore[reg.score-1]}else{curscore=""}s='<li><a href="javascript:toonuitslag('+n.toString()+","+reg.tafel.toString()+');">'+vbspelers[reg.wit-1].naam+" - "+vbspelers[reg.zwart-1].naam+curscore+"</a></li>";$("#rondelijst").append(s)}}if(eerstepagrondelijst){$("#rondelijst").listview("refresh")}else{eerstepagrondelijst=true}jQuery.mobile.changePage("#pagronde");return true};toonuitslag=function(ronde,tafel){var reg,scoreid,_i,_len;for(_i=0,_len=uitslagen.length;_i<_len;_i++){reg=uitslagen[_i];if(reg.ronde===ronde&&reg.tafel===tafel){uitslagform.ronde.value=reg.ronde;uitslagform.tafel.value=reg.tafel;uitslagform.witspeler.value=vbspelers[reg.wit-1].naam;uitslagform.zwartspeler.value=vbspelers[reg.zwart-1].naam;scoreid="#score"+reg.score.toString();console.log("scoreid",scoreid);if(eerstescorecheck){$(".uitslagscore").prop("checked",false).checkboxradio("refresh");$(scoreid).prop("checked",true).checkboxradio("refresh")}else{$(".uitslagscore").prop("checked",false);$(scoreid).prop("checked",true);eerstescorecheck=true}}}jQuery.mobile.changePage("#paguitslagform")};volgenderonde=function(){if(curronde<aantalspelers-1){toonronde(curronde+1)}};vorigeronde=function(){if(curronde>1){toonronde(curronde-1)}};toonspeler=function(n){$("#labelspeler").html("naam van speler "+(n+1).toString());spelerform.spelernr.value=n;spelerform.spelernaam.value=vbspelers[n].naam;jQuery.mobile.changePage("#pagspelerform")};bewaarcompetform=function(xf){var n,speler,_i;competnaam=xf.competnaam.value;aantalspelers=parseInt(xf.aantalspelers.value);if(aantalspelers>10){aantalspelers=10}if(!aantalspelers.isEven()){aantalspelers+=1}if(aantalspelers===0){aantalspelers=2}$("#tooncompetnaam").html("<h2>Competitie: "+competnaam+"</h2>");$("#toonaantalspelers").html("Aantal spelers: "+aantalspelers.toString());curronde=1;uitslagen=[];vbspelers=[];for(n=_i=1;1<=aantalspelers?_i<=aantalspelers:_i>=aantalspelers;n=1<=aantalspelers?++_i:--_i){speler={nr:n,naam:"speler "+n.toString()};vbspelers.push(speler)}inituitslagen();savecompet();toonspelers();savecompet();toonspelers();return false};bewaarspelerform=function(xf){var nr;nr=xf.spelernr.value;vbspelers[nr].naam=xf.spelernaam.value;savecompet();toonspelers();return false};bewaaruitslagform=function(xf){var reg,ronde,tafel,_i,_len;ronde=parseInt(xf.ronde.value);tafel=parseInt(xf.tafel.value);for(_i=0,_len=uitslagen.length;_i<_len;_i++){reg=uitslagen[_i];if(reg.ronde===ronde&&reg.tafel===tafel){if(xf.score0.checked){reg.score=0}if(xf.score1.checked){reg.score=1}if(xf.score2.checked){reg.score=2}if(xf.score3.checked){reg.score=3}}}savecompet();toonronde(ronde);return false};resetcompet=function(){competform.competnaam.value=competnaam;competform.aantalspelers.value=aantalspelers;jQuery.mobile.changePage("#pagcompetform")};testcompetbestaat=function(){if(storage.isSet("compet"+competnr.toString())&&!storage.isEmpty("compet"+competnr.toString())){return true}return false};$(document).ready(function(){if(testcompetbestaat()){loadcompet();$("#tooncompetnaam").html("<h2>Competitie: "+competnaam+"</h2>");$("#toonaantalspelers").html("Aantal spelers: "+aantalspelers.toString())}else{resetcompet()}if(uitslagen.length===0){inituitslagen();savecompet()}});this.bewaarspelerform=bewaarspelerform;this.bewaaruitslagform=bewaaruitslagform;this.bewaarcompetform=bewaarcompetform;this.toonspelers=toonspelers;this.toonspeler=toonspeler;this.toonronde=toonronde;this.vorigeronde=vorigeronde;this.volgenderonde=volgenderonde;this.toonuitslag=toonuitslag;this.toonstand=toonstand;this.resetcompet=resetcompet}).call(this);